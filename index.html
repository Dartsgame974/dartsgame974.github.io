<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redimensionner les fichiers</title>
</head>

<body>
    <!-- Input element to select files -->
    <input type="file" id="fileInput" multiple>

    <!-- Checkboxes for resizing options -->
    <label>
        <input type="checkbox" name="resizeOption" value="twitch"> Twitch
    </label>
    <label>
        <input type="checkbox" name="resizeOption" value="discord"> Discord
    </label>
    <label>
        <input type="checkbox" name="resizeOption" value="pointsDeChaine"> Points de chaîne
    </label>

    <!-- Button to initiate the resizing process -->
    <button onclick="resizeImages()">Redimensionner</button>

    <!-- JavaScript code -->
    <script>
        function resizeImages() {
            const selectedOptions = document.querySelectorAll('input[name="resizeOption"]:checked');
            const files = document.getElementById("fileInput").files;

            // Check if any files are selected
            if (files.length === 0) {
                alert("Aucun fichier sélectionné.");
                return;
            }

            // Resize and group the files
            let totalImages = selectedOptions.length * files.length;
            let imagesProcessed = 0;
            let zip = new JSZip();

            for (const file of files) {
                const fileName = file.name;
                const fileExtension = fileName.substring(fileName.lastIndexOf('.') + 1);

                // Check if the file is an image
                if (['png', 'jpg', 'jpeg', 'gif'].includes(fileExtension.toLowerCase())) {
                    for (const option of selectedOptions) {
                        const selectedOption = option.value;
                        const sizes = getSizes(selectedOption);
                        for (const size of sizes) {
                            resizeImage(file, selectedOption, size);
                        }
                    }
                }
            }

            function getSizes(option) {
                switch (option) {
                    case 'twitch':
                        return [72, 36, 18];
                    case 'discord':
                        return [256];
                    case 'pointsDeChaine':
                        return [28, 56, 112];
                    default:
                        return [];
                }
            }

            function resizeImage(file, option, size) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const img = new Image();
                    img.onload = function () {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = size;
                        canvas.height = size;
                        ctx.drawImage(img, 0, 0, size, size);
                        canvas.toBlob(function (blob) {
                            const fileName = `${option}/${file.name.substring(0, file.name.lastIndexOf('.'))}_${size}x${size}.png`;
                            zip.file(fileName, blob);
                            imagesProcessed++;
                            if (imagesProcessed === totalImages) {
                                zip.generateAsync({ type: "blob" }).then(function (content) {
                                    saveAs(content, "redimensionne.zip");
                                });
                            }
                        }, 'image/png');
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        // Include JSZip and FileSaver.js
        const scriptElem = document.createElement('script');
        scriptElem.src = "https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js";
        scriptElem.onload = function () {
            const fileSaverElem = document.createElement('script');
            fileSaverElem.src = "https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js";
            fileSaverElem.onload = function () {
                const script = document.createElement('script');
                script.innerHTML = `
                    let groupedFiles = {
                        twitch: { sizes: [72, 36, 18], files: [] },
                        discord: { sizes: [256], files: [] },
                        pointsDeChaine: { sizes: [28, 56, 112], files: [] },
                    };
                `;
                document.body.appendChild(script);
            };
            document.body.appendChild(fileSaverElem);
        };
        document.body.appendChild(scriptElem);
    </script>
</body>

</html>
