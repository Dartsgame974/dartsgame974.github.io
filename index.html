<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redimensionner les fichiers</title>
</head>

<body>
    <!-- Input element to select files -->
    <input type="file" id="fileInput" multiple>

    <!-- Button to initiate the resizing process -->
    <button onclick="resizeImages()">Redimensionner</button>

    <!-- JavaScript code -->
    <script>
        function resizeImages() {
            const files = document.getElementById("fileInput").files;

            // Check if any files are selected
            if (files.length === 0) {
                alert("Aucun fichier sélectionné.");
                return;
            }

            // Group the files based on their sizes and selected options
            const groupedFiles = {
                twitch: { sizes: [72, 36, 18], files: [] },
                discord: { sizes: [256], files: [] },
                pointsDeChaine: { sizes: [28, 56, 112], files: [] },
            };

            for (const file of files) {
                const fileName = file.name;
                const fileExtension = fileName.substring(fileName.lastIndexOf('.') + 1);

                // Check if the file is an image
                if (['png', 'jpg', 'jpeg', 'gif'].includes(fileExtension.toLowerCase())) {
                    for (const option in groupedFiles) {
                        const sizes = groupedFiles[option].sizes;
                        for (const size of sizes) {
                            resizeImage(file, option, size);
                        }
                    }
                }
            }
        }

        function resizeImage(file, option, size) {
            const reader = new FileReader();
            reader.onload = function (event) {
                const img = new Image();
                img.onload = function () {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = size;
                    canvas.height = size;
                    ctx.drawImage(img, 0, 0, size, size);
                    canvas.toBlob(function (blob) {
                        groupedFiles[option].files.push(blob);
                        checkAllDone();
                    }, 'image/png');
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Global variable to track completion of all image resizing
        let imagesToResize = 0;
        let imagesResized = 0;
        let groupedFiles = {
            twitch: { sizes: [72, 36, 18], files: [] },
            discord: { sizes: [256], files: [] },
            pointsDeChaine: { sizes: [28, 56, 112], files: [] },
        };

        function checkAllDone() {
            imagesResized++;
            if (imagesResized === imagesToResize) {
                // All images are resized, create the zip file
                const zip = new JSZip();
                for (const option in groupedFiles) {
                    for (const file of groupedFiles[option].files) {
                        zip.file(`${option}_${file.width}x${file.height}.png`, file);
                    }
                }

                // Save the zip with the appropriate name
                zip.generateAsync({ type: "blob" }).then(function (content) {
                    saveAs(content, "redimensionne.zip");
                });
            }
        }

        function getSize(fileName) {
            const regex = /(\d+)x(\d+)/;
            const match = fileName.match(regex);
            if (match) {
                return match[0];
            }
            return "unknown";
        }
    </script>

    <!-- Include JSZip and FileSaver.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>
</body>

</html>
