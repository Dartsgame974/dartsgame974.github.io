<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Redimensionnement d'Images et Création d'un Fichier Zip</title>
</head>
<body>
    <h1>Redimensionnement d'Images</h1>
    <input type="file" id="fileInput" multiple>
    <br>
    <p>Sélectionnez les résolutions :</p>
    <label>
        <input type="checkbox" name="resolutions" value="Twitch">Twitch
    </label>
    <label>
        <input type="checkbox" name="resolutions" value="Discord">Discord
    </label>
    <label>
        <input type="checkbox" name="resolutions" value="Points de chaîne">Points de chaîne
    </label>
    <br>
    <button id="resizeButton">Redimensionner</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        // Fonction pour redimensionner une image dans une résolution spécifiée
        function resizeImage(image, resolution) {
            const canvas = document.createElement('canvas');
            canvas.width = resolution;
            canvas.height = resolution;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(image, 0, 0, resolution, resolution);
            return canvas.toDataURL('image/jpeg', 1.0);
        }

        // Fonction pour créer un fichier zip à partir des images redimensionnées
        function createZip(imagesData) {
            const zip = new JSZip();

            imagesData.forEach((imageData) => {
                const { folder, resolution, data } = imageData;
                const folderName = folder + " " + resolution;
                zip.folder(folderName).file(`${resolution}.jpg`, data.split(',')[1], { base64: true });
            });

            zip.generateAsync({ type: 'blob' }).then((content) => {
                saveAs(content, 'images_resized.zip');
            });
        }

        // Fonction appelée lorsque le bouton "Redimensionner" est cliqué
        function onResizeButtonClick() {
            const selectedResolutions = Array.from(document.querySelectorAll('input[name="resolutions"]:checked'))
                .map(input => input.value);

            const files = document.getElementById('fileInput').files;
            if (files.length === 0 || selectedResolutions.length === 0) {
                alert('Veuillez sélectionner au moins un fichier et une résolution.');
                return;
            }

            const imagesData = [];

            // Boucle pour traiter chaque fichier sélectionné
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();

                reader.onload = function(event) {
                    const image = new Image();
                    image.src = event.target.result;
                    image.onload = function() {
                        // Boucle pour redimensionner l'image pour chaque résolution choisie
                        for (const resolution of selectedResolutions) {
                            const [width, height] = resolutionToSize(resolution);
                            const resizedData = resizeImage(image, width);
                            imagesData.push({ folder: resolution, resolution: `${width}x${height}`, data: resizedData });
                        }

                        // Vérifie si toutes les images ont été redimensionnées avant de créer le zip
                        if (imagesData.length === files.length * selectedResolutions.length) {
                            createZip(imagesData);
                        }
                    };
                };
                reader.readAsDataURL(file);
            }
        }

        // Fonction pour obtenir la taille correspondant à la résolution choisie
        function resolutionToSize(resolution) {
            switch (resolution) {
                case 'Twitch':
                    return [72, 72];
                case 'Discord':
                    return [256, 256];
                case 'Points de chaîne':
                    return [112, 112];
                default:
                    return [0, 0];
            }
        }

        // Attache l'événement "click" au bouton "Redimensionner"
        document.getElementById('resizeButton').addEventListener('click', onResizeButtonClick);
    </script>
</body>
</html>
